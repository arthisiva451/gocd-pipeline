---
# Define pipeline group
- group:
    name: My Deployment Pipeline Group
    pipelines:
      # Define pipeline 1
      - name: pipe1
        label_template: '${COUNT}'
        materials:
          - git: https://github.com/my-repo.git
            branch: main
        stages:
          - name: build
            jobs:
              - name: test
                tasks:
                  - exec:
                      command: echo "Running tests for pipe1"
              - name: build
                tasks:
                  - exec:
                      command: echo "Building pipe1"
          - name: deploy
            jobs:
              - name: deploy
                tasks:
                  - exec:
                      command: echo "Deploying pipe1"
        # Define artifact to pass to pipe2
        artifacts:
          - source: output/
            destination: pipe1_output/
      # Define pipeline 2
      - name: pipe2
        label_template: '${COUNT}'
        materials:
          - git: https://github.com/my-repo.git
            branch: main
          # Define dependency on pipe1
          - pipeline: pipe1
            stage: deploy
            material_name: pipe1-deploy
        stages:
          - name: build
            jobs:
              - name: test
                tasks:
                  - exec:
                      command: echo "Running tests for pipe2"
              - name: build
                tasks:
                  - exec:
                      command: echo "Building pipe2"
                # Define input from pipe1
                artifacts:
                  - source: ../pipe1_output/
          - name: deploy
            jobs:
              - name: deploy
                tasks:
                  - exec:
                      command: echo "Deploying pipe2"
